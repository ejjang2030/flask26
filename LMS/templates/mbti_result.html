{% extends "layout.html" %}

{% block head %}
<meta property="og:title" content="ë‚˜ì˜ ê°œë°œì MBTIëŠ”? {{ mbti }} - {{ result.title }}">
<meta property="og:description" content="{{ result.desc }}">
<meta property="og:image" content="{{ url_for('static', filename='logo/communa_logo.svg', _external=True) }}">
{% endblock %}

{% block content %}
<div class="container py-5 text-center" style="max-width: 600px;">

    <div class="card shadow-lg border-0 rounded-5 overflow-hidden">
        <div class="card-header bg-primary text-white p-4">
            <h5 class="mb-0 opacity-75">ë‹¹ì‹ ì˜ ê°œë°œì ìœ í˜•ì€?</h5>
            <h1 class="display-1 fw-bold my-2">{{ mbti }}</h1>
        </div>

        <div class="card-body p-5 bg-white">
            <div class="mb-4">
                <span class="display-1">ğŸ‘¾</span>
            </div>

            <h2 class="fw-bold text-primary mb-2">{{ result.animal }}</h2>
            <h4 class="text-dark fw-bold mb-4">"{{ result.title }}"</h4>

            <p class="lead text-muted mb-4" style="word-break: keep-all;">
                {{ result.desc }}
            </p>

            <hr class="my-4">

            <div class="d-grid gap-2 col-10 mx-auto mb-4">
                <button onclick="shareResult()" class="btn btn-dark rounded-pill fw-bold py-3 shadow-sm">
                    <i class="bi bi-share-fill me-2"></i>
                    <span id="shareBtnText">ê²°ê³¼ ê³µìœ í•˜ê¸°</span>
                </button>
            </div>

            <div class="d-grid gap-2">
<!--                <a href="/board" class="btn btn-outline-primary rounded-pill">ì»¤ë®¤ë‹ˆí‹°ì— ìë‘í•˜ê¸°</a>-->
                <a href="/mbti" class="btn btn-link text-muted text-decoration-none">ë‹¤ì‹œ í…ŒìŠ¤íŠ¸í•˜ê¸°</a>
            </div>
        </div>
    </div>

</div>

<script>
    // 1. ê³µìœ í•  ë°ì´í„° ì¤€ë¹„ (í˜„ì¬ URLì— ê²°ê³¼ íƒ€ì…ì´ í¬í•¨ë˜ì–´ ìˆì–´ì•¼ í•¨)
    // ì˜ˆ: https://communa.vercel.app/mbti/result?type=ENTJ
    const shareTitle = "ë‚˜ì˜ ê°œë°œì MBTIëŠ”? [{{ mbti }} - {{ result.title }}]";
    const shareText = "{{ result.desc }}";
    const shareUrl = window.location.href; // í˜„ì¬ í˜ì´ì§€ ì£¼ì†Œ ê·¸ëŒ€ë¡œ ê³µìœ 

    // 2. í†µí•© ê³µìœ  í•¨ìˆ˜ (ëª¨ë°”ì¼ì€ ê³µìœ ì‹œíŠ¸, PCëŠ” ë³µì‚¬)
    async function shareResult() {
        // (A) ëª¨ë°”ì¼ ë“± ê³µìœ  ê¸°ëŠ¥ì´ ìˆëŠ” ë¸Œë¼ìš°ì €
        if (navigator.share) {
            try {
                await navigator.share({
                    title: shareTitle,
                    text: shareText,
                    url: shareUrl,
                });
                console.log('ê³µìœ  ì„±ê³µ');
            } catch (err) {
                // ì‚¬ìš©ìê°€ ê³µìœ  ì°½ì„ ë‹«ê±°ë‚˜ ì·¨ì†Œí–ˆì„ ë•Œ ì—ëŸ¬ ë¬´ì‹œ
                console.log('ê³µìœ  ì·¨ì†Œë¨');
            }
        }
        // (B) PC ë“± ê³µìœ  ê¸°ëŠ¥ì´ ì—†ëŠ” ë¸Œë¼ìš°ì € -> í´ë¦½ë³´ë“œ ë³µì‚¬ë¡œ ëŒ€ì²´
        else {
            try {
                await navigator.clipboard.writeText(shareUrl);
                alert('ê²°ê³¼ ë§í¬ê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤! \nì¹´ì¹´ì˜¤í†¡ì´ë‚˜ SNSì— ë¶™ì—¬ë„£ê¸° í•˜ì„¸ìš”.');
            } catch (err) {
                prompt('ì´ ì£¼ì†Œë¥¼ ë³µì‚¬í•´ì„œ ê³µìœ í•˜ì„¸ìš”:', shareUrl);
            }
        }
    }

    // PC ì ‘ì† ì‹œ ë²„íŠ¼ í…ìŠ¤íŠ¸ ë³€ê²½ UX
    document.addEventListener("DOMContentLoaded", function() {
        if (!navigator.share) {
            document.getElementById('shareBtnText').innerText = "ê²°ê³¼ ë§í¬ ë³µì‚¬í•˜ê¸°";
        }
    });
</script>
{% endblock %}